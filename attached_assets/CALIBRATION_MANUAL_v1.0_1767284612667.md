# РУКОВОДСТВО ПО КАЛИБРОВКЕ
# Библиотечная RFID-система самообслуживания

**Версия:** 1.0  
**Дата:** 31 декабря 2024  
**Платформа:** Raspberry Pi 4 + Arduino/ESP32  

---

# СОДЕРЖАНИЕ

1. [Введение](#1-введение)
2. [Порядок калибровки](#2-порядок-калибровки)
3. [Тест кинематики CoreXY (K)](#3-тест-кинематики-corexy-команда-k)
4. [Калибровка 10 ключевых точек (C)](#4-калибровка-10-ключевых-точек-команда-c)
5. [Калибровка всех 21 ряда Y (*)](#5-калибровка-всех-21-ряда-y-команда-)
6. [Калибровка захвата полки (L)](#6-калибровка-захвата-полки-команда-l)
7. [Калибровка платформы (T)](#7-калибровка-платформы-команда-t)
8. [Редактор заблокированных ячеек (#)](#8-редактор-заблокированных-ячеек-команда-)
9. [Сохранение и загрузка калибровки](#9-сохранение-и-загрузка-калибровки)
10. [Структура калибровочных данных](#10-структура-калибровочных-данных)
11. [Проверка калибровки](#11-проверка-калибровки)
12. [Устранение неполадок](#12-устранение-неполадок)

---

# 1. ВВЕДЕНИЕ

## 1.1 Назначение документа

Данное руководство описывает процедуры калибровки механической части библиотечного шкафа книговыдачи. Калибровка необходима для точного позиционирования каретки и корректной работы системы захвата полок.

## 1.2 Когда требуется калибровка

| Ситуация | Требуемая калибровка |
|----------|---------------------|
| Первый запуск системы | Полная (все режимы) |
| Замена мотора | K (кинематика) + C (точки) |
| Замена ремня | C (точки) |
| Механическая регулировка | C (точки) или * (все Y) |
| Замена полки | L (захват) |
| Изменение конфигурации ячеек | # (заблокированные) |
| Сброс EEPROM | Полная |

## 1.3 Необходимое оборудование

- Компьютер с терминалом (Serial Monitor / PuTTY)
- USB кабель для подключения к контроллеру
- Линейка или рулетка (опционально)
- Тестовая полка

## 1.4 Общие клавиши управления

| Клавиша | Действие | Контекст |
|---------|----------|----------|
| **W** | Движение вверх (Y+) | Везде |
| **A** | Движение влево (X-) | Везде |
| **S** | Движение вниз (Y-) | Везде |
| **D** | Движение вправо (X+) | Везде |
| **1-9** | Размер шага | Везде |
| **ПРОБЕЛ** | Аварийная остановка | Везде |
| **ENTER** | Подтвердить/Сохранить | Калибровка |
| **N** | Пропустить | Калибровка |
| **Q** | Выход | Везде |
| **?** | Справка | Везде |
| **I** | Информация | Везде |

## 1.5 Размеры шага

| Клавиша | Шаг | Применение |
|---------|-----|------------|
| **1** | 1 мм | Точная доводка |
| **2** | 2 мм | Точная доводка |
| **3** | 5 мм | Мелкая коррекция |
| **4** | 10 мм | Стандартный (по умолчанию) |
| **5** | 15 мм | Средняя коррекция |
| **6** | 20 мм | Средняя коррекция |
| **7** | 30 мм | Грубое позиционирование |
| **8** | 50 мм | Грубое позиционирование |
| **9** | 100 мм | Быстрое перемещение |

---

# 2. ПОРЯДОК КАЛИБРОВКИ

## 2.1 Рекомендуемая последовательность

```
┌─────────────────────────────────────────────────────────────────┐
│                    ПОРЯДОК КАЛИБРОВКИ                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ① Проверка оборудования                                       │
│     └── Датчики (1), Шторки (3-6), Замки (7-8), Моторы (ASDF)  │
│                          ↓                                      │
│  ② Тест кинематики CoreXY (K)                                  │
│     └── Определение направлений моторов A и B                  │
│                          ↓                                      │
│  ③ Калибровка 10 ключевых точек (C)                            │
│     └── Базовые позиции X[0-2] и Y[0,1,5,10,15,20]            │
│                          ↓                                      │
│  ④ Калибровка всех 21 ряда Y (*) — ОПЦИОНАЛЬНО                 │
│     └── Точные позиции Y[0-20]                                 │
│                          ↓                                      │
│  ⑤ Калибровка захвата полки (L)                                │
│     └── Параметры extend1, retract, extend2 для FRONT и BACK   │
│                          ↓                                      │
│  ⑥ Настройка заблокированных ячеек (#)                         │
│     └── Пометить ячейки с механизмами                          │
│                          ↓                                      │
│  ⑦ Сохранение в EEPROM (>)                                     │
│     └── Постоянное хранение калибровки                         │
│                          ↓                                      │
│  ⑧ Проверка (X, O, N)                                          │
│     └── Быстрый тест, TAKE, GIVE                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 2.2 Время калибровки

| Этап | Команда | Время | Обязательно |
|------|---------|-------|-------------|
| Проверка оборудования | 1-8, ASDF | 5-10 мин | ✅ Да |
| Тест кинематики | K | 2-3 мин | ✅ Да |
| 10 ключевых точек | C | 10-15 мин | ✅ Да |
| Все 21 ряд Y | * | 20-30 мин | ⚠️ Рекомендуется |
| Захват полки | L | 5-10 мин | ✅ Да |
| Заблокированные ячейки | # | 2-3 мин | ✅ Да |
| Сохранение | > | 1 сек | ✅ Да |
| Проверка | X, O, N | 5-10 мин | ✅ Да |
| **ИТОГО** | | **50-80 мин** | |

---

# 3. ТЕСТ КИНЕМАТИКИ CoreXY (команда K)

## 3.1 Назначение

Определить соответствие между вращением моторов A и B и направлением движения каретки. В системе CoreXY каретка перемещается за счёт комбинированного вращения двух моторов.

## 3.2 Теория CoreXY

```
                    МОТОР B
                       ●
                      /│\
                     / │ \
                    /  │  \
                   /   │   \
                  /    │    \
    МОТОР A ●────/─────┼─────\────● ШКИВ
                \     ═══     /
                 \   КАРЕТКА /
                  \    │    /
                   \   │   /
                    \  │  /
                     \ │ /
                      \│/
                       ●
                     ШКИВ
```

**Формулы движения:**
```
Движение X+ (вправо): Motor A вперёд  + Motor B назад
Движение X- (влево):  Motor A назад   + Motor B вперёд
Движение Y+ (вверх):  Motor A вперёд  + Motor B вперёд
Движение Y- (вниз):   Motor A назад   + Motor B назад
```

## 3.3 Предусловия

- [ ] Система включена и инициализирована
- [ ] Каретка не в крайнем положении (есть место для движения)
- [ ] Платформа втянута
- [ ] Нет препятствий на пути каретки

## 3.4 Пошаговая процедура

### ШАГ 1: Запуск теста

```
Ввод: K

Ответ системы:
╔══════════════════════════════════════════════════════════════╗
║              ТЕСТ КИНЕМАТИКИ CoreXY                          ║
╠══════════════════════════════════════════════════════════════╣
║  Сейчас будет вращаться каждый мотор по очереди.            ║
║  Ваша задача — указать, куда движется КАРЕТКА.              ║
║                                                              ║
║  Варианты ответа:                                            ║
║    W — вверх (Y+)                                            ║
║    S — вниз (Y-)                                             ║
║    A — влево (X-)                                            ║
║    D — вправо (X+)                                           ║
║    Q — выход                                                 ║
╚══════════════════════════════════════════════════════════════╝

Нажмите ENTER для начала...
```

### ШАГ 2: Тест мотора A (по часовой)

```
>>> ШАГ 1/4: Мотор A вращается ПО ЧАСОВОЙ <<<

[Мотор A вращается 1 секунду]

Куда поехала каретка? (W/A/S/D):
```

**Действия оператора:**
1. Наблюдать за кареткой
2. Определить направление движения
3. Нажать соответствующую клавишу:
   - **W** — если каретка поехала вверх
   - **S** — если каретка поехала вниз
   - **A** — если каретка поехала влево
   - **D** — если каретка поехала вправо

```
Ввод: D

Ответ: ✓ Мотор A+ → Вправо (X+). Записано.
```

### ШАГ 3: Тест мотора A (против часовой)

```
>>> ШАГ 2/4: Мотор A вращается ПРОТИВ ЧАСОВОЙ <<<

[Мотор A вращается 1 секунду]

Куда поехала каретка? (W/A/S/D):
```

```
Ввод: A

Ответ: ✓ Мотор A- → Влево (X-). Записано.
```

### ШАГ 4: Тест мотора B (по часовой)

```
>>> ШАГ 3/4: Мотор B вращается ПО ЧАСОВОЙ <<<

[Мотор B вращается 1 секунду]

Куда поехала каретка? (W/A/S/D):
```

```
Ввод: W

Ответ: ✓ Мотор B+ → Вверх (Y+). Записано.
```

### ШАГ 5: Тест мотора B (против часовой)

```
>>> ШАГ 4/4: Мотор B вращается ПРОТИВ ЧАСОВОЙ <<<

[Мотор B вращается 1 секунду]

Куда поехала каретка? (W/A/S/D):
```

```
Ввод: S

Ответ: ✓ Мотор B- → Вниз (Y-). Записано.
```

### ШАГ 6: Результат

```
╔══════════════════════════════════════════════════════════════╗
║              РЕЗУЛЬТАТ ТЕСТА КИНЕМАТИКИ                      ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  На основе ваших ответов вычислены направления:             ║
║                                                              ║
║  ┌─────────────┬─────────────┬─────────────┐                ║
║  │ Движение    │  Мотор A    │  Мотор B    │                ║
║  ├─────────────┼─────────────┼─────────────┤                ║
║  │ X+ (вправо) │     +1      │     -1      │                ║
║  │ X- (влево)  │     -1      │     +1      │                ║
║  │ Y+ (вверх)  │     +1      │     +1      │                ║
║  │ Y- (вниз)   │     -1      │     -1      │                ║
║  └─────────────┴─────────────┴─────────────┘                ║
║                                                              ║
║  Сохранить? (Y/N):                                          ║
╚══════════════════════════════════════════════════════════════╝
```

```
Ввод: Y

Ответ: ✓ Кинематика сохранена!
```

## 3.5 Проверка результата

После калибровки кинематики проверьте WASD управление:

| Клавиша | Ожидаемое движение | Результат |
|---------|-------------------|-----------|
| W | Каретка вверх (Y+) | ☐ OK / ☐ НЕВЕРНО |
| S | Каретка вниз (Y-) | ☐ OK / ☐ НЕВЕРНО |
| A | Каретка влево (X-) | ☐ OK / ☐ НЕВЕРНО |
| D | Каретка вправо (X+) | ☐ OK / ☐ НЕВЕРНО |

## 3.6 Возможные ошибки

| Ошибка | Причина | Решение |
|--------|---------|---------|
| Каретка не движется | Мотор отключен | Проверить подключение |
| Движение диагональное | Ремень соскочил | Проверить ремни |
| Неправильное направление | Ошибка при ответе | Повторить тест K |

## 3.7 Критерии успеха

- [x] Все 4 шага пройдены
- [x] WASD управление соответствует ожиданиям
- [x] Данные сохранены

---

# 4. КАЛИБРОВКА 10 КЛЮЧЕВЫХ ТОЧЕК (команда C)

## 4.1 Назначение

Определить позиции (в шагах мотора) для всех колонок X и ключевых рядов Y. Эти данные используются для навигации каретки к любой ячейке шкафа.

## 4.2 Карта маршрута калибровки

```
Y
↑
20 ┤  ⑧─────────────────────────────────────────────⑩
   │  │                                              │
   │  │                                              │
15 ┤  ⑦                                              │
   │  │                                              │
   │  │                                              │
10 ┤  ⑥─────────────────────⑨                       │
   │  │                      │                       │
   │  │                      │                       │
 5 ┤  ⑤                      │                       │
   │  │                      │                       │
   │  │                      │                       │
 1 ┤  ④                      │                       │
 0 ┼──①━━━━━━━━━━━━━━━━━━━━━②━━━━━━━━━━━━━━━━━━━━━━━③
   └──┴─────────────────────┴───────────────────────┴──→ X
      0                     1                       2
      
Легенда:
  ① - ⑩  = точки калибровки (порядок прохождения)
  ━━━━━  = движение вдоль X
  │      = движение вдоль Y
```

## 4.3 Таблица 10 точек

| № | Координаты | Способ подъезда | Что калибрует | Важность |
|---|------------|-----------------|---------------|----------|
| ① | (0, 0) | HOME → вручную | X[0], Y[0] — начало координат | 🔴 Критично |
| ② | (1, 0) | Вручную | X[1] — центральная колонка, вычисляет шаг X | 🔴 Критично |
| ③ | (2, 0) | АВТО + доводка | X[2] — правая колонка | 🔴 Критично |
| ④ | (0, 1) | Возврат + вручную | Y[1] — вычисляет шаг Y | 🔴 Критично |
| ⑤ | (0, 5) | АВТО + доводка | Y[5] | 🟡 Важно |
| ⑥ | (0, 10) | АВТО + доводка | Y[10] — середина | 🟡 Важно |
| ⑦ | (0, 15) | АВТО + доводка | Y[15] | 🟡 Важно |
| ⑧ | (0, 20) | АВТО + доводка | Y[20] — верх | 🟡 Важно |
| ⑨ | (1, 10) | АВТО + доводка | Проверка центра | 🟢 Проверка |
| ⑩ | (2, 20) | АВТО + доводка | Проверка угла | 🟢 Проверка |

**АВТО** — система сама подъезжает к расчётной позиции на основе уже откалиброванных точек.

## 4.4 Предусловия

- [ ] Кинематика откалибрована (команда K)
- [ ] Система инициализирована (HOME выполнен)
- [ ] Платформа втянута
- [ ] Все ячейки пусты (нет полок на пути)

## 4.5 Пошаговая процедура

### ШАГ 0: Запуск калибровки

```
Ввод: C

Ответ системы:
╔══════════════════════════════════════════════════════════════╗
║            КАЛИБРОВКА 10 КЛЮЧЕВЫХ ТОЧЕК                      ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Маршрут: (0,0)→(1,0)→(2,0)→(0,1)→(0,5)→(0,10)→            ║
║           (0,15)→(0,20)→(1,10)→(2,20)                       ║
║                                                              ║
║  Управление:                                                 ║
║    W/A/S/D — движение каретки                               ║
║    1-9     — размер шага                                    ║
║    ENTER   — сохранить и далее                              ║
║    N       — пропустить точку                               ║
║    I       — информация                                     ║
║    Q       — выход                                          ║
║                                                              ║
║  Нажмите ENTER для начала...                                ║
╚══════════════════════════════════════════════════════════════╝
```

### ТОЧКА ① — (0, 0)

```
╔══════════════════════════════════════════════════════════════╗
║  ТОЧКА 1/10: Ячейка (0, 0)                                  ║
║  Колонка: 0 (левая)                                         ║
║  Ряд: 0 (нижний)                                            ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Текущая позиция: X = 0, Y = 0                              ║
║  Целевая позиция: X = ???, Y = ???                          ║
║                                                              ║
║  Используйте W/A/S/D для подводки каретки                   ║
║  к ЦЕНТРУ ячейки (0, 0)                                     ║
║                                                              ║
║  Шаг: 10 мм (нажмите 1-9 для изменения)                     ║
║                                                              ║
║  [ENTER] — сохранить   [N] — пропустить   [Q] — выход       ║
╚══════════════════════════════════════════════════════════════╝
```

**Действия оператора:**

1. **Грубое позиционирование** (шаг 8 или 9):
   ```
   Ввод: 9DDD
   → Шаг: 100 мм, движение вправо 300 мм
   ```

2. **Среднее позиционирование** (шаг 4 или 5):
   ```
   Ввод: 4DD
   → Шаг: 10 мм, движение вправо 20 мм
   ```

3. **Точная доводка** (шаг 1 или 2):
   ```
   Ввод: 1A
   → Шаг: 1 мм, движение влево 1 мм
   ```

4. **Сохранение**:
   ```
   Ввод: [ENTER]
   
   Ответ: ✓ Сохранено: (0, 0) = X:1891 Y:0
           Шаг X оценён как: 4500
   ```

### ТОЧКА ② — (1, 0)

```
╔══════════════════════════════════════════════════════════════╗
║  ТОЧКА 2/10: Ячейка (1, 0)                                  ║
║  Колонка: 1 (центральная)                                   ║
║  Ряд: 0 (нижний)                                            ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Текущая позиция: X = 1891, Y = 0                           ║
║  Целевая позиция: X = ???, Y = 0                            ║
║                                                              ║
║  ⚠️ Важно: После этой точки система вычислит шаг по X       ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

**Действия:**
```
Ввод: 8DDD4D1DD
→ Грубо вправо, средне вправо, точно вправо

Ввод: [ENTER]

Ответ: ✓ Сохранено: (1, 0) = X:6392 Y:0
       ШАГ X = 4501 (разница между X[1] и X[0])
```

### ТОЧКА ③ — (2, 0)

```
╔══════════════════════════════════════════════════════════════╗
║  ТОЧКА 3/10: Ячейка (2, 0)                                  ║
║  Колонка: 2 (правая)                                        ║
║  Ряд: 0 (нижний)                                            ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  >>> АВТО-ПОДЪЕЗД <<<                                       ║
║  Еду к расчётной позиции: X = 10893                         ║
║  ...                                                         ║
║  Приехал. Доведите вручную если нужно.                      ║
║                                                              ║
║  Текущая позиция: X = 10893, Y = 0                          ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

**Действия:**
```
(Система сама подъехала к расчётной позиции)

Ввод: 1D
→ Точная доводка вправо

Ввод: [ENTER]

Ответ: ✓ Сохранено: (2, 0) = X:10894 Y:0
```

### ТОЧКА ④ — (0, 1)

```
╔══════════════════════════════════════════════════════════════╗
║  ТОЧКА 4/10: Ячейка (0, 1)                                  ║
║  Колонка: 0 (левая)                                         ║
║  Ряд: 1                                                      ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  >>> ВОЗВРАТ К КОЛОНКЕ 0 <<<                                ║
║  Еду к X[0] = 1891...                                       ║
║                                                              ║
║  ⚠️ Важно: После этой точки система вычислит шаг по Y       ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

**Действия:**
```
Ввод: 8WW4W1W
→ Грубо вверх, средне вверх, точно вверх

Ввод: [ENTER]

Ответ: ✓ Сохранено: (0, 1) = X:1891 Y:423
       ШАГ Y = 423
```

### ТОЧКИ ⑤-⑧ — Y = 5, 10, 15, 20

Система автоматически подъезжает к каждой точке. Оператор выполняет только доводку:

```
ТОЧКА 5/10: (0, 5)
>>> АВТО-ПОДЪЕЗД к Y = 2115 <<<
Ввод: 1S [ENTER]
✓ Сохранено: Y[5] = 2113

ТОЧКА 6/10: (0, 10)
>>> АВТО-ПОДЪЕЗД к Y = 4230 <<<
Ввод: [ENTER]
✓ Сохранено: Y[10] = 4230

ТОЧКА 7/10: (0, 15)
>>> АВТО-ПОДЪЕЗД к Y = 6345 <<<
Ввод: 1WW [ENTER]
✓ Сохранено: Y[15] = 6347

ТОЧКА 8/10: (0, 20)
>>> АВТО-ПОДЪЕЗД к Y = 8460 <<<
Ввод: 1S [ENTER]
✓ Сохранено: Y[20] = 8459
```

### ТОЧКИ ⑨-⑩ — Проверочные

```
ТОЧКА 9/10: (1, 10) — ПРОВЕРКА ЦЕНТРА
>>> АВТО-ПОДЪЕЗД к X=6392, Y=4230 <<<
Ввод: [ENTER]
✓ Проверка пройдена: отклонение < 2 мм

ТОЧКА 10/10: (2, 20) — ПРОВЕРКА УГЛА
>>> АВТО-ПОДЪЕЗД к X=10894, Y=8459 <<<
Ввод: 1A [ENTER]
✓ Проверка пройдена: коррекция 1 мм
```

### ЗАВЕРШЕНИЕ

```
╔══════════════════════════════════════════════════════════════╗
║            КАЛИБРОВКА ЗАВЕРШЕНА!                             ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Откалибровано точек: 10/10                                 ║
║  Пропущено: 0                                               ║
║                                                              ║
║  РЕЗУЛЬТАТЫ:                                                 ║
║  ┌─────────────────────────────────────────────────────┐    ║
║  │ Позиции X:                                          │    ║
║  │   X[0] = 1891                                       │    ║
║  │   X[1] = 6392                                       │    ║
║  │   X[2] = 10894                                      │    ║
║  │                                                     │    ║
║  │ Позиции Y:                                          │    ║
║  │   Y[0] = 0      Y[10] = 4230    Y[20] = 8459       │    ║
║  │   Y[1] = 423    Y[15] = 6347                       │    ║
║  │   Y[5] = 2113                                      │    ║
║  │                                                     │    ║
║  │ Шаг X ≈ 4501, Шаг Y ≈ 423                          │    ║
║  └─────────────────────────────────────────────────────┘    ║
║                                                              ║
║  ⚠️ Не забудьте сохранить в EEPROM (команда >)              ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

## 4.6 Интерполяция промежуточных рядов

После калибровки 10 точек система автоматически вычисляет позиции для всех остальных рядов Y методом линейной интерполяции:

```
Y[2] = Y[1] + (Y[5] - Y[1]) / 4 × 1
Y[3] = Y[1] + (Y[5] - Y[1]) / 4 × 2
Y[4] = Y[1] + (Y[5] - Y[1]) / 4 × 3
...
```

## 4.7 Критерии успеха

- [x] Все 10 точек откалиброваны (или сознательно пропущены)
- [x] Шаг X примерно одинаков между колонками (±5%)
- [x] Шаг Y примерно одинаков между рядами (±5%)
- [x] Проверочные точки ⑨ и ⑩ прошли с отклонением < 5 мм

---

# 5. КАЛИБРОВКА ВСЕХ 21 РЯДА Y (команда *)

## 5.1 Назначение

Точная калибровка каждого из 21 ряда (Y = 0...20). Используется когда линейная интерполяция недостаточно точна (например, из-за неравномерности ремня или механики).

## 5.2 Когда нужна

- После базовой калибровки (C) точность недостаточна
- Полки не попадают точно в пазы
- Видна систематическая ошибка в определённых рядах

## 5.3 Предусловия

- [ ] Базовая калибровка 10 точек выполнена (C)
- [ ] Кинематика откалибрована (K)

## 5.4 Процедура

```
Ввод: *

╔══════════════════════════════════════════════════════════════╗
║          КАЛИБРОВКА ВСЕХ 21 РЯДА Y                           ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Будут последовательно откалиброваны ряды Y = 0...20        ║
║  Колонка X = 0 (левая)                                       ║
║                                                              ║
║  Управление:                                                 ║
║    W/S — вверх/вниз                                         ║
║    1-9 — размер шага                                        ║
║    ENTER — сохранить                                        ║
║    N — пропустить                                           ║
║    Q — выход                                                ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

### Прохождение рядов

```
>>> РЯД Y = 0 <<<
Текущая позиция: Y = 0
Оценка: Y = 0
Доведите к центру ряда.
Ввод: [ENTER]
✓ Y[0] = 0

>>> РЯД Y = 1 <<<
Еду к оценке: Y = 423
Текущая позиция: Y = 423
Доведите к центру ряда.
Ввод: 1W [ENTER]
✓ Y[1] = 424

>>> РЯД Y = 2 <<<
Еду к оценке: Y = 846
...

>>> РЯД Y = 20 <<<
Еду к оценке: Y = 8460
Ввод: [ENTER]
✓ Y[20] = 8460

╔══════════════════════════════════════════════════════════════╗
║  КАЛИБРОВКА ВСЕХ Y ЗАВЕРШЕНА!                                ║
║  Откалибровано: 21/21 рядов                                  ║
╚══════════════════════════════════════════════════════════════╝
```

## 5.5 Визуальный прогресс

```
Прогресс калибровки Y:
[✓] Y=0   [✓] Y=1   [✓] Y=2   [✓] Y=3   [✓] Y=4
[✓] Y=5   [✓] Y=6   [▶] Y=7   [ ] Y=8   [ ] Y=9
[ ] Y=10  [ ] Y=11  [ ] Y=12  [ ] Y=13  [ ] Y=14
[ ] Y=15  [ ] Y=16  [ ] Y=17  [ ] Y=18  [ ] Y=19
[ ] Y=20

✓ = откалибровано
▶ = текущий
  = ожидает
```

---

# 6. КАЛИБРОВКА ЗАХВАТА ПОЛКИ (команда L)

## 6.1 Назначение

Настройка параметров выдвижения платформы для корректного захвата полок. Полка имеет два пропила, за которые цепляется язычок замка.

## 6.2 Механика захвата

```
        ПОЛКА (вид сбоку)
        ═══════════════════════════════
           ↓                ↓
         ПРОПИЛ 1        ПРОПИЛ 2
           │                │
           ▼                ▼
        ┌──┴──┐          ┌──┴──┐
        │     │          │     │
════════┘     └══════════┘     └════════
                                        
        ←────── extend1 ──────→
        ←── retract ──→
        ←────────── extend2 ──────────→
```

## 6.3 Параметры захвата

| Параметр | Описание | Типичное значение |
|----------|----------|-------------------|
| **extend1** | Первое выдвижение (до 1-го пропила) | 1500 шагов |
| **retract** | Втягивание (назад от 1-го пропила) | 1500 шагов |
| **extend2** | Второе выдвижение (до 2-го пропила) | 3000 шагов |

## 6.4 Последовательность захвата

```
ШАГ 1: Выдвижение до 1-го пропила (extend1)
       ┌─────────────────────┐
       │      ПЛАТФОРМА      │ →→→ выдвигается
       └─────────────────────┘
                              ↓ язычок
                           ┌──┴──┐
       ═══════════════════╡     ╞═══
                           └─────┘
                          ПРОПИЛ 1

ШАГ 2: Закрыть замок (язычок входит в пропил 1)
       ┌─────────────────────┐
       │      ПЛАТФОРМА      │
       └──────────┬──────────┘
                  │ язычок ВНУТРИ
               ┌──┴──┐
       ════════╡  ●  ╞══════════════
               └─────┘

ШАГ 3: Втягивание (retract) — полка начинает двигаться
       ┌─────────────────────┐
       │      ПЛАТФОРМА      │ ←←← втягивается
       └──────────┬──────────┘
                  │
               ┌──┴──┐
       ════════╡  ●  ╞═══════ ←←← полка едет с платформой
               └─────┘

ШАГ 4: Открыть замок (освободить пропил 1)
       ┌─────────────────────┐
       │      ПЛАТФОРМА      │
       └─────────────────────┘
                              ↓ язычок СНАРУЖИ
                           ┌──┴──┐
       ════════════════════╡     ╞═══
                           └─────┘

ШАГ 5: Выдвижение до 2-го пропила (extend2)
       ┌─────────────────────┐
       │      ПЛАТФОРМА      │ →→→ выдвигается дальше
       └─────────────────────┘
                                           ↓ язычок
                                        ┌──┴──┐
       ═════════════════════════════════╡     ╞
                                        └─────┘
                                       ПРОПИЛ 2

ШАГ 6: Закрыть замок (язычок входит в пропил 2)
       ┌─────────────────────┐
       │      ПЛАТФОРМА      │
       └──────────────────────┬──────────┘
                              │ язычок ВНУТРИ
                           ┌──┴──┐
       ════════════════════╡  ●  ╞
                           └─────┘

ШАГ 7: Втянуть полностью — полка на платформе!
```

## 6.5 Процедура калибровки

```
Ввод: L

╔══════════════════════════════════════════════════════════════╗
║            КАЛИБРОВКА ЗАХВАТА ПОЛКИ                          ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Выберите ряд: [F] FRONT или [B] BACK                       ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

### ЭТАП 1: Настройка extend1

```
>>> ЭТАП 1/3: ПЕРВОЕ ВЫДВИЖЕНИЕ (extend1) <<<

Установите тестовую полку в ячейку.
Каретка должна быть напротив ячейки.

Текущее значение: extend1 = 1500 шагов

Управление:
  [+] / [-]  — изменить на 10 шагов
  [W] / [S]  — изменить на 100 шагов
  [T]        — тест (выдвинуть и вернуть)
  [ENTER]    — подтвердить и далее

Цель: Платформа должна выдвинуться так, чтобы
      язычок замка был ТОЧНО над 1-м пропилом.
```

**Действия:**
```
Ввод: T
→ Платформа выдвигается на 1500 шагов, пауза 2 сек, втягивается

(Смотрим — язычок не доехал до пропила)

Ввод: WWWW
→ extend1 = 1900

Ввод: T
→ Тест... язычок над пропилом!

Ввод: [ENTER]
✓ extend1 = 1900 сохранено
```

### ЭТАП 2: Проверка захвата 1

```
>>> ПРОВЕРКА ЗАХВАТА 1 <<<

Сейчас выполним:
1. Выдвижение на extend1 = 1900
2. Закрытие замка
3. Пауза 2 сек (проверьте захват!)
4. Открытие замка
5. Втягивание

Нажмите [ENTER] для теста или [Q] для выхода
```

```
Ввод: [ENTER]

Выдвижение... Замок закрыт...

⚠️ ПРОВЕРЬТЕ: Язычок вошёл в пропил 1?
   [Y] — да, захват OK
   [N] — нет, нужна коррекция

Ввод: Y
✓ Захват 1 подтверждён
```

### ЭТАП 3: Настройка retract

```
>>> ЭТАП 2/3: ВТЯГИВАНИЕ (retract) <<<

Текущее значение: retract = 1500 шагов

Цель: Втянуть платформу так, чтобы полка отошла от стеллажа,
      но язычок ещё мог освободить 1-й пропил.
```

### ЭТАП 4: Настройка extend2

```
>>> ЭТАП 3/3: ВТОРОЕ ВЫДВИЖЕНИЕ (extend2) <<<

Текущее значение: extend2 = 3000 шагов

Цель: Выдвинуть платформу так, чтобы
      язычок был ТОЧНО над 2-м пропилом.
```

### ЗАВЕРШЕНИЕ

```
╔══════════════════════════════════════════════════════════════╗
║        КАЛИБРОВКА ЗАХВАТА FRONT ЗАВЕРШЕНА!                   ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Параметры:                                                  ║
║    extend1 = 1900                                            ║
║    retract = 1500                                            ║
║    extend2 = 3100                                            ║
║                                                              ║
║  [T] — полный тест захвата                                  ║
║  [B] — калибровать BACK                                     ║
║  [Q] — выход                                                ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

## 6.6 Полный тест захвата

```
Ввод: T

>>> ПОЛНЫЙ ТЕСТ ЗАХВАТА <<<

[1/7] Выдвижение 1 (extend1 = 1900)...
[2/7] Закрытие замка...
[3/7] Втягивание (retract = 1500)...
[4/7] Открытие замка...
[5/7] Выдвижение 2 (extend2 = 3100)...
[6/7] Закрытие замка...
[7/7] Полное втягивание...

✓ ТЕСТ ПРОЙДЕН! Полка захвачена.
  Время: 8.3 сек

Втянуть полку обратно в ячейку? [Y/N]
```

## 6.7 Отдельная калибровка FRONT и BACK

⚠️ **ВАЖНО:** Параметры для FRONT и BACK могут отличаться!

| Параметр | FRONT (Lock1) | BACK (Lock2) |
|----------|---------------|--------------|
| extend1 | 1900 | 1850 |
| retract | 1500 | 1500 |
| extend2 | 3100 | 3050 |

---

# 7. КАЛИБРОВКА ПЛАТФОРМЫ (команда T)

## 7.1 Назначение

Настройка полного хода платформы в направлениях FRONT и BACK.

## 7.2 Параметры

| Параметр | Описание |
|----------|----------|
| **trayMaxFront** | Максимальное выдвижение вперёд (к пользователю) |
| **trayMaxBack** | Максимальное выдвижение назад (к стене) |

## 7.3 Процедура

```
Ввод: T

╔══════════════════════════════════════════════════════════════╗
║            КАЛИБРОВКА ПЛАТФОРМЫ                              ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  [F] — калибровать FRONT (вперёд)                           ║
║  [B] — калибровать BACK (назад)                             ║
║  [Q] — выход                                                ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

```
Ввод: F

>>> КАЛИБРОВКА FRONT <<<

Платформа будет выдвигаться вперёд.
Нажмите [ПРОБЕЛ] когда достигнет предела.

Выдвижение...
[=================>                    ] 45%

Ввод: [ПРОБЕЛ]

✓ trayMaxFront = 4523 шагов
```

---

# 8. РЕДАКТОР ЗАБЛОКИРОВАННЫХ ЯЧЕЕК (команда #)

## 8.1 Назначение

Пометить ячейки, которые заняты механизмами или недоступны. Система не будет пытаться использовать эти ячейки.

## 8.2 Заблокированные по умолчанию

### FRONT ряд

| Колонка | Заблокированные Y | Причина |
|---------|-------------------|---------|
| 0 | — | Свободна |
| 1 | 7, 8, 9 | Окно выдачи |
| 1 | 10, 11, 12, 13, 14, 15, 16, 17, 18 | Механизм шторок |
| 2 | — | Свободна |

### BACK ряд

| Колонка | Заблокированные Y | Причина |
|---------|-------------------|---------|
| 0 | 19, 20 | Механизм |
| 1 | 19, 20 | Механизм |
| 2 | 20 | Механизм |

## 8.3 Визуальная карта

```
╔══════════════════════════════════════════════════════════════╗
║            КАРТА ЗАБЛОКИРОВАННЫХ ЯЧЕЕК                       ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║    FRONT:               BACK:                                ║
║    Col 0   1   2        Col 0   1   2                       ║
║  Y20  .   .   .          X   X   X                          ║
║  Y19  .   .   .          X   X   .                          ║
║  Y18  .   X   .          .   .   .                          ║
║  Y17  .   X   .          .   .   .                          ║
║  Y16  .   X   .          .   .   .                          ║
║  Y15  .   X   .          .   .   .                          ║
║  Y14  .   X   .          .   .   .                          ║
║  Y13  .   X   .          .   .   .                          ║
║  Y12  .   X   .          .   .   .                          ║
║  Y11  .   X   .          .   .   .                          ║
║  Y10  .   X   .          .   .   .                          ║
║  Y9   .  [O]  .          .   .   .    ← Окно выдачи        ║
║  Y8   .  [O]  .          .   .   .                          ║
║  Y7   .  [O]  .          .   .   .                          ║
║  Y6   .   .   .          .   .   .                          ║
║  Y5   .   .   .          .   .   .                          ║
║  Y4   .   .   .          .   .   .                          ║
║  Y3   .   .   .          .   .   .                          ║
║  Y2   .   .   .          .   .   .                          ║
║  Y1   .   .   .          .   .   .                          ║
║  Y0   .   .   .          .   .   .                          ║
║                                                              ║
║  Легенда:  . = доступна   X = заблокирована   [O] = окно   ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

## 8.4 Команды редактирования

```
╔══════════════════════════════════════════════════════════════╗
║            РЕДАКТОР ЗАБЛОКИРОВАННЫХ ЯЧЕЕК                    ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Формат команды: [F/B] [X] [Y] [+/-]                        ║
║                                                              ║
║  Примеры:                                                    ║
║    F 1 10 +   → заблокировать FRONT, колонка 1, ряд 10      ║
║    B 0 19 -   → разблокировать BACK, колонка 0, ряд 19      ║
║    F 2 5-8 +  → заблокировать FRONT, колонка 2, ряды 5-8    ║
║                                                              ║
║  Служебные команды:                                          ║
║    D — установить значения по умолчанию                     ║
║    S — показать карту                                       ║
║    C — очистить все (разблокировать всё)                    ║
║    Q — выход                                                ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

## 8.5 Примеры

```
Ввод: F 1 10 +
✓ Заблокировано: FRONT (1, 10)

Ввод: F 1 10-15 +
✓ Заблокировано: FRONT (1, 10), (1, 11), (1, 12), (1, 13), (1, 14), (1, 15)

Ввод: B 2 20 -
✓ Разблокировано: BACK (2, 20)

Ввод: D
✓ Установлены значения по умолчанию

Ввод: S
[Показывает карту]

Ввод: Q
Выход из редактора
```

---

# 9. СОХРАНЕНИЕ И ЗАГРУЗКА КАЛИБРОВКИ

## 9.1 Команды EEPROM

| Команда | Действие | Описание |
|---------|----------|----------|
| **>** | Сохранить в EEPROM | Запись всех калибровочных данных |
| **<** | Загрузить из EEPROM | Чтение сохранённых данных |
| **!** | Очистить EEPROM | Сброс к заводским настройкам |
| **=** | Экспорт JSON | Вывод данных для копирования |

## 9.2 Сохранение (команда >)

```
Ввод: >

╔══════════════════════════════════════════════════════════════╗
║            СОХРАНЕНИЕ В EEPROM                               ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  Будут сохранены:                                           ║
║    ✓ Кинематика CoreXY                                      ║
║    ✓ Позиции X[0-2]                                         ║
║    ✓ Позиции Y[0-20]                                        ║
║    ✓ Позиция окна                                           ║
║    ✓ Параметры захвата FRONT                                ║
║    ✓ Параметры захвата BACK                                 ║
║    ✓ Скорости                                               ║
║    ✓ Заблокированные ячейки                                 ║
║                                                              ║
║  Размер данных: 198 байт                                    ║
║                                                              ║
║  Сохранить? [Y/N]                                           ║
╚══════════════════════════════════════════════════════════════╝
```

```
Ввод: Y

Запись в EEPROM...
[====================] 100%

✓ Калибровка сохранена!
  Checksum: 0xA3B7
```

## 9.3 Загрузка (команда <)

```
Ввод: <

Чтение EEPROM...
Проверка checksum...

✓ Калибровка загружена!
  Magic: 0xCA1B (OK)
  Checksum: 0xA3B7 (OK)
  Версия: 2.1
```

## 9.4 Экспорт JSON (команда =)

```
Ввод: =

╔══════════════════════════════════════════════════════════════╗
║            ЭКСПОРТ КАЛИБРОВКИ (JSON)                         ║
╠══════════════════════════════════════════════════════════════╣

{
  "version": "2.1",
  "timestamp": "2024-12-31T14:30:00",
  
  "kinematics": {
    "x_plus_dir_a": 1,
    "x_plus_dir_b": -1,
    "y_plus_dir_a": 1,
    "y_plus_dir_b": 1
  },
  
  "positions": {
    "x": [1891, 6392, 10894],
    "y": [0, 423, 846, 1269, 1692, 2113, 2538, 2961, 3384, 3807,
         4230, 4653, 5076, 5499, 5922, 6347, 6770, 7193, 7616, 8039, 8459]
  },
  
  "window": {
    "x": 1,
    "y": 9
  },
  
  "grab_front": {
    "extend1": 1900,
    "retract": 1500,
    "extend2": 3100
  },
  
  "grab_back": {
    "extend1": 1850,
    "retract": 1500,
    "extend2": 3050
  },
  
  "speeds": {
    "xy": 4000,
    "tray": 2000,
    "acceleration": 8000
  },
  
  "blocked_cells": {
    "front": {
      "0": [],
      "1": [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
      "2": []
    },
    "back": {
      "0": [19, 20],
      "1": [19, 20],
      "2": [20]
    }
  }
}

╚══════════════════════════════════════════════════════════════╝

Скопируйте данные для резервного хранения.
```

## 9.5 Импорт калибровки

В Python-сервере:

```python
# Загрузка из файла
with open('calibration.json', 'r') as f:
    calibration = json.load(f)

# Применение
await mechanics.load_calibration(calibration)
```

---

# 10. СТРУКТУРА КАЛИБРОВОЧНЫХ ДАННЫХ

## 10.1 EEPROM структура (C++)

```cpp
struct CalibrationData {
    // Заголовок
    uint16_t magic;              // 0xCA1B — сигнатура
    uint8_t version;             // Версия структуры
    
    // Кинематика CoreXY
    int8_t xPlusDirA;            // +1 или -1
    int8_t xPlusDirB;            // +1 или -1
    int8_t yPlusDirA;            // +1 или -1
    int8_t yPlusDirB;            // +1 или -1
    
    // Позиции колонок X (в шагах)
    int32_t posX[3];             // X[0], X[1], X[2]
    
    // Позиции рядов Y (в шагах)
    int32_t posY[21];            // Y[0]...Y[20]
    
    // Позиция окна выдачи
    uint8_t windowX;             // 0-2
    uint8_t windowY;             // 0-20
    
    // Параметры захвата FRONT
    int32_t grabFrontExtend1;
    int32_t grabFrontRetract;
    int32_t grabFrontExtend2;
    
    // Параметры захвата BACK
    int32_t grabBackExtend1;
    int32_t grabBackRetract;
    int32_t grabBackExtend2;
    
    // Скорости
    int32_t speedXY;             // шагов/сек
    int32_t speedTray;           // шагов/сек
    int32_t acceleration;        // шагов/сек²
    
    // Заблокированные ячейки (битовые маски)
    // Каждый uint32_t хранит 21 бит для рядов Y
    uint32_t blockedFront[3];    // [колонка] → биты для Y
    uint32_t blockedBack[3];
    
    // Контрольная сумма
    uint16_t checksum;
    
    // Размер: ~200 байт
};
```

## 10.2 JSON схема

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Calibration Data",
  "type": "object",
  "required": ["version", "kinematics", "positions", "window", "grab_front", "grab_back"],
  
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    
    "kinematics": {
      "type": "object",
      "properties": {
        "x_plus_dir_a": { "type": "integer", "enum": [-1, 1] },
        "x_plus_dir_b": { "type": "integer", "enum": [-1, 1] },
        "y_plus_dir_a": { "type": "integer", "enum": [-1, 1] },
        "y_plus_dir_b": { "type": "integer", "enum": [-1, 1] }
      }
    },
    
    "positions": {
      "type": "object",
      "properties": {
        "x": {
          "type": "array",
          "items": { "type": "integer" },
          "minItems": 3,
          "maxItems": 3
        },
        "y": {
          "type": "array",
          "items": { "type": "integer" },
          "minItems": 21,
          "maxItems": 21
        }
      }
    },
    
    "window": {
      "type": "object",
      "properties": {
        "x": { "type": "integer", "minimum": 0, "maximum": 2 },
        "y": { "type": "integer", "minimum": 0, "maximum": 20 }
      }
    },
    
    "grab_front": {
      "type": "object",
      "properties": {
        "extend1": { "type": "integer" },
        "retract": { "type": "integer" },
        "extend2": { "type": "integer" }
      }
    },
    
    "grab_back": {
      "type": "object",
      "properties": {
        "extend1": { "type": "integer" },
        "retract": { "type": "integer" },
        "extend2": { "type": "integer" }
      }
    }
  }
}
```

---

# 11. ПРОВЕРКА КАЛИБРОВКИ

## 11.1 Быстрый тест ячейки (команда X)

```
Ввод: X

╔══════════════════════════════════════════════════════════════╗
║              БЫСТРЫЙ ТЕСТ ЯЧЕЙКИ                              ║
╠══════════════════════════════════════════════════════════════╣
║                                                              ║
║  FRONT или BACK? [F/B]: F                                   ║
║  Колонка X [0-2]: 1                                          ║
║  Ряд Y [0-20]: 5                                             ║
║                                                              ║
╚══════════════════════════════════════════════════════════════╝
```

```
>>> БЫСТРЫЙ ТЕСТ: FRONT (1, 5) <<<

[1/6] Инициализация (HOME)...
  [====                ] 16%
[2/6] Проверка платформы...
  [========            ] 33%
[3/6] Движение к ячейке (1, 5)...
  [============        ] 50%
[4/6] Выдвижение платформы...
  [================    ] 66%
[5/6] Втягивание платформы...
  [==================  ] 83%
[6/6] Возврат HOME...
  [====================] 100%

✓ ТЕСТ ПРОЙДЕН!
  Время: 12.5 сек
  Ошибок: 0
```

## 11.2 Полный цикл TAKE (команда O)

```
Ввод: O

>>> ПОЛНЫЙ ЦИКЛ TAKE FRONT <<<

FRONT или BACK? [F/B]: F
Колонка X [0-2]: 0
Ряд Y [0-20]: 5

Режим: [A] авто или [ENTER] пошагово?

Ввод: [ENTER]

[1/27] Проверка инициализации
  Нажмите ENTER...
[2/27] Проверка платформы
  Платформа втянута ✓
[3/27] Проверка ячейки (0, 5)
  Ячейка доступна ✓
...
[27/27] Возврат пустой полки

✓ ЦИКЛ TAKE ЗАВЕРШЁН!
  Время: 45.3 сек
```

## 11.3 Полный цикл GIVE (команда N)

Аналогично TAKE, но в обратном направлении.

## 11.4 Чек-лист проверки

| Тест | Команда | Результат |
|------|---------|-----------|
| WASD управление | Ручное | ☐ OK |
| Быстрый тест (0, 0) | X | ☐ OK |
| Быстрый тест (1, 10) | X | ☐ OK |
| Быстрый тест (2, 20) | X | ☐ OK |
| TAKE FRONT | O | ☐ OK |
| GIVE FRONT | N | ☐ OK |
| TAKE BACK | $ | ☐ OK |
| GIVE BACK | % | ☐ OK |

---

# 12. УСТРАНЕНИЕ НЕПОЛАДОК

## 12.1 Каретка едёт не в ту сторону

**Симптом:** При нажатии W каретка едет вниз (или другое несоответствие)

**Причина:** Неверная калибровка кинематики

**Решение:**
1. Выполнить команду K (тест кинематики)
2. Внимательно следить за направлением движения
3. Сохранить в EEPROM (>)

## 12.2 Каретка не точно попадает в ячейку

**Симптом:** Полка не входит в пазы или входит криво

**Причина:** Неточная калибровка позиций

**Решение:**
1. Выполнить команду C (10 точек) или * (все Y)
2. Использовать мелкий шаг (1-2) для точной доводки
3. Проверить командой X

## 12.3 Полка не захватывается

**Симптом:** Язычок не попадает в пропил

**Причина:** Неверные параметры захвата

**Решение:**
1. Выполнить команду L (калибровка захвата)
2. Настроить extend1 так, чтобы язычок был точно над пропилом
3. Проверить полным тестом (T в меню L)

## 12.4 Ошибка "Платформа не втянута"

**Симптом:** Система отказывается двигать каретку

**Причина:** Датчик Tray Begin не срабатывает

**Решение:**
1. Проверить датчик командой 1
2. Вручную втянуть платформу
3. Проверить подключение датчика

## 12.5 Таймаут мотора

**Симптом:** Ошибка #2 — мотор не завершил движение за 30 сек

**Причина:** Механическое препятствие или отключен мотор

**Решение:**
1. Проверить механику (нет ли препятствий)
2. Проверить подключение мотора
3. Проверить ремни

## 12.6 EEPROM не загружается

**Симптом:** Ошибка при команде <

**Причина:** Повреждённые данные или другая версия

**Решение:**
1. Очистить EEPROM (!)
2. Выполнить полную калибровку
3. Сохранить (>)

---

# ПРИЛОЖЕНИЯ

## А. Таблица команд калибровки

| Команда | Название | Время | Сохраняет |
|---------|----------|-------|-----------|
| K | Тест кинематики | 2-3 мин | Кинематику |
| C | 10 ключевых точек | 10-15 мин | X[0-2], Y (ключевые) |
| * | Все 21 ряд Y | 20-30 мин | Y[0-20] |
| L | Захват полки | 5-10 мин | grab_front/back |
| T | Платформа | 2-3 мин | trayMax |
| # | Заблокированные | 2-3 мин | blocked_cells |
| > | Сохранить EEPROM | 1 сек | Всё |
| < | Загрузить EEPROM | 1 сек | — |
| = | Экспорт JSON | 1 сек | — |
| ! | Очистить EEPROM | 1 сек | — |

## Б. Типичные значения

| Параметр | Типичное значение | Диапазон |
|----------|-------------------|----------|
| Шаг X | 4500 шагов | 4000-5000 |
| Шаг Y | 420 шагов | 400-450 |
| extend1 | 1500-1900 | 1000-2500 |
| retract | 1500 | 1000-2000 |
| extend2 | 3000-3100 | 2500-3500 |
| speedXY | 4000 | 2000-8000 |
| speedTray | 2000 | 1000-4000 |

---

**КОНЕЦ ДОКУМЕНТА**

Версия: 1.0  
Дата: 31 декабря 2024  
Объём: ~1000 строк
