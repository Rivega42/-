# Отчет по настройке RFID системы
**Дата:** 14 января 2026  
**Статус:** ✅ Система полностью функциональна

## Итоговая конфигурация

### Оборудование
1. **NFC считыватель ACR1281U-C**
   - Статус: ✅ Работает
   - Интерфейс: PC/SC (3 интерфейса: 00 00, 00 01, 00 02)
   - Дальность: 5-10 см
   - Читает: библиотечные билеты

2. **UHF считыватель IQRFID-5102 (UHF Reader Bee02 V1.6)**
   - Статус: ✅ Работает
   - Порт: /dev/ttyUSB0 (через USB хаб с питанием)
   - Дальность: 3-5 см (аппаратное ограничение встроенной антенны)
   - Читает: ЕКП карты

3. **UHF считыватель RRU9816**
   - Статус: ✅ Подключен
   - Порт: /dev/ttyUSB1
   - Для: книжные метки

## Выполненные работы

### 1. Настройка udev правил
✅ Созданы символические ссылки для стабильных имён устройств:
- `/dev/rfid_uhf_card` → ttyUSB0 (IQRFID-5102)
- `/dev/rfid_book` → ttyUSB1 (RRU9816)

### 2. Исправление NFC считывателя
✅ Проблема: ACR1281 имеет 3 интерфейса, карты читаются на интерфейсе 00 01
✅ Решение: Изменён код для опроса всех трёх интерфейсов

### 3. Исправление переподключения
✅ Проблема: После disconnect() считыватели не переподключались
✅ Решение: Добавлен метод _disconnect_readers() без сброса флагов

### 4. Питание и подключение
✅ UHF считыватели подключены через USB хаб с внешним питанием
✅ NFC считыватель подключен напрямую к Raspberry Pi

## Тестирование

### Прочитанные карты:
- **NFC:** `04239092F17380` (библиотечный билет)
- **UHF:** `304DB75F19600009F0022743` (ЕКП карта)

### Скрипты для тестирования:
- `test_rfid_readers.py` - комплексный тест всех считывателей
- `configure_rfid_power.py` - настройка мощности (не эффективна для IQRFID-5102)

## Ограничения

### 1. Дальность считывания
- IQRFID-5102: только 3-5 см из-за встроенной печатной антенны
- ACR1281: стандартные 5-10 см для NFC

### 2. Работа через стекло 8мм
⚠️ **КРИТИЧЕСКОЕ ОГРАНИЧЕНИЕ:**
- Текущие считыватели НЕ БУДУТ работать через стекло 8мм
- Необходимо либо вырезать окна в стекле, либо использовать выносные антенны

### 3. Регулировка мощности
- IQRFID-5102: мощность не регулируется программно
- ACR1281: фиксированная мощность по стандарту NFC

## Рекомендации

### Для работы через стекло 8мм:
1. **Заменить IQRFID-5102** на модель с разъёмом для внешней антенны
2. **Вырезать окна** в стекле в местах установки считывателей
3. **Использовать более тонкий материал** (2-3мм пластик)

### Для увеличения дальности:
1. **UHF:** Необходим считыватель с внешней антенной (Impinj R420, ThingMagic M6e)
2. **NFC:** Ограничено стандартом, максимум 10-15 см

## Сервис

### Запуск системы:
```bash
sudo systemctl start bookcabinet
sudo systemctl status bookcabinet
```

### Веб-интерфейс:
- Локально: http://localhost:5000
- По сети: http://10.10.31.12:5000

## Файлы проекта

### Основные:
- `/bookcabinet/rfid/unified_card_reader.py` - унифицированный драйвер
- `/bookcabinet/hardware/iqrfid5102_driver.py` - драйвер IQRFID-5102
- `/bookcabinet/test_rfid_readers.py` - тестирование
- `/bookcabinet/configure_rfid_power.py` - настройка мощности

### Конфигурация:
- `/etc/udev/rules.d/99-bookcabinet-rfid.rules` - udev правила
- `/bookcabinet/config.py` - конфигурация системы

---
**Система готова к эксплуатации с учётом указанных ограничений**
